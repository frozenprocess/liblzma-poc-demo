package_update: true
packages:
  - docker-registry
  - docker.io
users:
  - default
write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKI0szU19WRVJTSU9OPSJ2MS4yMy4xNiUyQmszczEiCiNLM1NfVkVSU0lPTj0idjEuMjUuOCUyQmszczEiCkszU19WRVJTSU9OPSQxCgpBUkNIPWB1bmFtZSAtbWAKaWYgW1sgJEFSQ0ggPT0gIng4Nl82NCIgXV0KdGhlbgplY2hvICJEb3dubG9hZGluZyBrM3MgYmluYXJ5IGZvciAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vazNzLWlvL2szcy9yZWxlYXNlcy9kb3dubG9hZC8kSzNTX1ZFUlNJT04vazNzIC1vIC91c3IvbG9jYWwvYmluL2szcwplY2hvICJEb3dubG9hZGluZyBjYWxpY29jdGwgYmluYXJ5ICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0Y2FsaWNvL2NhbGljby9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2FsaWNvY3RsLWxpbnV4LWFtZDY0IC1vIC91c3IvbG9jYWwvYmluL2NhbGljb2N0bAplbHNlCmVjaG8gIkRvd25sb2FkaW5nIGszcyBiaW5hcnkgZm9yICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9rM3MtaW8vazNzL3JlbGVhc2VzL2Rvd25sb2FkLyRLM1NfVkVSU0lPTi9rM3MtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vazNzCmVjaG8gIkRvd25sb2FkaW5nIGNhbGljb2N0bCBiaW5hcnkgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RjYWxpY28vY2FsaWNvL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jYWxpY29jdGwtbGludXgtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsCmZpCgovdXNyL2Jpbi9jaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9rM3MKL3Vzci9iaW4vY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsIAoKL3Vzci9iaW4vY3VybCBodHRwczovL2dldC5rM3MuaW8vID4gL3Jvb3QvaW5zdGFsbC5zaAovdXNyL2Jpbi9jaG1vZCAreCAvcm9vdC9pbnN0YWxsLnNoCgojIE1hYyBPUyBkaXNjb3ZlcnkgZml4CmNhdCA+PiAvZXRjL3N5c3RlbWQvcmVzb2x2ZWQuY29uZiA8PC1FT0YKTXVsdGljYXN0RE5TPXllcwpEb21haW5zPW11bHRpcGFzcyBtc2hvbWUubmV0IGxvY2FsCkVPRgovdXNyL2Jpbi9zeXN0ZW1jdGwgZW5hYmxlIHN5c3RlbWQtcmVzb2x2ZWQuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBzeXN0ZW1kLXJlc29sdmVkLnNlcnZpY2UKCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vbWRuc0Auc2VydmljZSA8PC1FT0YKW1NlcnZpY2VdClR5cGU9b25lc2hvdApFeGVjU3RhcnQ9L3Vzci9iaW4vcmVzb2x2ZWN0bCBtZG5zICVpIHllcwpBZnRlcj1zeXMtc3Vic3lzdGVtLW5ldC1kZXZpY2VzLSVpLmRldmljZQoKW0luc3RhbGxdCldhbnRlZEJ5PXN5cy1zdWJzeXN0ZW0tbmV0LWRldmljZXMtJWkuZGV2aWNlCkVPRgoKSU5URVJGQUNFPWBpcCBsaW5rIHNob3cgIHwgZWdyZXAgIlswLTldOiBlbiIgfCBhd2sgJ3sgcHJpbnQgJDIgfScgfCBjdXQgLWQ6IC1mMWAKCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgbWRuc0AkSU5URVJGQUNFLnNlcnZpY2UKL3Vzci9iaW4vc3lzdGVtY3RsIHN0YXJ0IG1kbnNAJElOVEVSRkFDRS5zZXJ2aWNlCiMgTWFjIE9TIGRpc2NvdmVyeSBmaXgKCgpjYXQgPiAvaG9tZS91YnVudHUveHpfdnVsbmVyYWJpbGl0eS5iYXNoIDw8LUVPRgojIS9iaW4vYmFzaAoKZWNobyAiSSdtIGZ1bGx5IGF3YXJlIHRoYXQgYnkgcnVubmluZyB0aGlzIHNjcmlwdCBJJ2xsIG1ha2UgbXkgc3lzdGVtIHZ1bG5lcmFibGUgdG8gY3ZlLTIwMjQtMzA5NCIKZWNobyAiUGxlYXNlIHVzZSAoWSkgdG8gYWNjZXB0IHRoZSBhYm92ZSBzdGF0ZW1lbnQgb3IgYW55dGhpbmcgZWxzZSB0byBjYW5jZWw6IgpyZWFkIC1yc24xIGtleSAgIyBSZWFkIGEgc2luZ2xlIGNoYXJhY3RlciBzaWxlbnRseQppZiBbWyAiXCRrZXkiICE9ICJZIiAmJiAiXCRrZXkiICE9ICJ5IiBdXTsgdGhlbgogICAgZWNobyAiUHJvZ3JhbSB0ZXJtaW5hdGVkLiIKICAgIGV4aXQgMQpmaQoKc3VkbyB3Z2V0IGh0dHBzOi8vc25hcHNob3QuZGViaWFuLm9yZy9hcmNoaXZlL2RlYmlhbi8yMDI0MDMyOFQwMjU2NTdaL3Bvb2wvbWFpbi94L3h6LXV0aWxzL2xpYmx6bWE1XzUuNi4xLTFfYW1kNjQuZGViCnN1ZG8gYXB0LWdldCBpbnN0YWxsIC0tYWxsb3ctZG93bmdyYWRlcyAtLXllcyAuL2xpYmx6bWE1XzUuNi4xLTFfYW1kNjQuZGViCnN1ZG8gY3VybCAtT0wgaHR0cHM6Ly9naXRodWIuY29tL2FtbHdlZW1zL3h6Ym90L3Jhdy9tYWluL2Fzc2V0cy9saWJsem1hLnNvLjUuNi4xLnBhdGNoCnN1ZG8gbXYgbGlibHptYS5zby41LjYuMS5wYXRjaCAvbGliL3g4Nl82NC1saW51eC1nbnUvbGlibHptYS5zby41LjYuMQoKZWNobyAiIgplY2hvICJDb25ncmF0dWxhdGlvbnMgeW91ciBzZXR1cCBpcyBub3cgdnVsbmVyYWJsZSB0byBDVkUtMjAyNC0zMDk0IgpFT0YKCmNobW9kICt4IC9ob21lL3VidW50dS94el92dWxuZXJhYmlsaXR5LmJhc2gKCmNhdCA+IC9ldGMvbW90ZCA8PC1FT0YKClZ1bG5lcmFiaWxpdHkgd29ya3Nob3AsIGFuZCBwcmV2ZW50aW5nIGl0IHdpdGggQ2FsaWNvISEhCkNoZWNrIG91dCBodHRwczovL2dpdGh1Yi5jb20vZnJvemVucHJvY2Vzcy9saWJsem1hLXBvYy1kZW1vIGZvciBtb3JlIGluZm9ybWF0aW9uLgpFT0YK
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: dmVyc2lvbjogMC4xCmxvZzoKICBmaWVsZHM6CiAgICBzZXJ2aWNlOiByZWdpc3RyeQpzdG9yYWdlOgogIGNhY2hlOgogICAgYmxvYmRlc2NyaXB0b3I6IGlubWVtb3J5CiAgZmlsZXN5c3RlbToKICAgIHJvb3RkaXJlY3Rvcnk6IC92YXIvbGliL2RvY2tlci1yZWdpc3RyeQogIGRlbGV0ZToKICAgIGVuYWJsZWQ6IHRydWUKaHR0cDoKICBhZGRyOiAwLjAuMC4wOjUwMDAKICBoZWFkZXJzOgogICAgWC1Db250ZW50LVR5cGUtT3B0aW9uczogW25vc25pZmZdCiAgdGxzOgogICAgY2VydGlmaWNhdGU6IC9ldGMvZG9ja2VyL3JlZ2lzdHJ5L2NhLmNydAogICAga2V5OiAvZXRjL2RvY2tlci9yZWdpc3RyeS9jYS5rZXkKaGVhbHRoOgogIHN0b3JhZ2Vkcml2ZXI6CiAgICBlbmFibGVkOiB0cnVlCiAgICBpbnRlcnZhbDogMTBzCiAgICB0aHJlc2hvbGQ6IDMK
  owner: root:root
  path: /etc/docker/registry/config.yml
- encoding: b64
  content: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR6RENDQXJTZ0F3SUJBZ0lVZXRuNWdObndrbjFCaHBweERBN09oUFVEL2Nvd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1BURVZNQk1HQTFVRUF3d01jSEpwZG1GMFpTMXlaWEJ2TVJjd0ZRWURWUVFLREE1WFpTQnNiM1psSUVOaApiR2xqYnpFTE1Ba0dBMVVFQmhNQ1ZWTXdIaGNOTWpRd05EQTVNVGcxTkRFNVdoY05NamN3TVRJNE1UZzFOREU1CldqQTlNUlV3RXdZRFZRUUREQXh3Y21sMllYUmxMWEpsY0c4eEZ6QVZCZ05WQkFvTURsZGxJR3h2ZG1VZ1EyRnMKYVdOdk1Rc3dDUVlEVlFRR0V3SlZVekNDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQgpBTXY4MU8vQXM5MXJkb3NWc25ub0hhb004RnFVMUZwOWtmMXIzUXlUMlBFeFFDNUVIeFFVQnBkWUlSREQzMEQyCkR1MEdCdjFxYWsxZ2J4TlBuSDl1aVg3d0daQ25zbEQ4NGVpenBBYUxrZWJaQk9JbStFcjlubVN1bkRjY3l6b3gKRi9udzZJTlVvcUZWcDc0clJwUWdieE1mL1UwTFZTTXpkd3dVN3hlbnJsNUlNSTg4emlOdFBlc1BtSnhnbE5RUQpiWXcrWGtKaEdQbWtWYzlmb3BHeWVQTUhEbTFQa2tUelRCY0ZodzVpcVJSd2txVE9RMWNEczhzOXJSajIzOStaCnd6NDBhYUF4aTBETWdsckxtb0ZEMS9kcTcxWUJLR05BR0FGSFZkWjltMWg3aU5NMXRHN21sdUhoRDJ5bDNSbXEKMDlGSm5MM245NFc3KzVUTU9zYWl4ekVDQXdFQUFhT0J3ekNCd0RBTEJnTlZIUThFQkFNQ0JEQXdFd1lEVlIwbApCQXd3Q2dZSUt3WUJCUVVIQXdFd1hBWURWUjBSQkZVd1U0SVdjSEpwZG1GMFpTMXlaWEJ2TG0xMWJIUnBjR0Z6CmM0SVhjSEpwZG1GMFpTMXlaWEJ2TG0xemFHOXRaUzV1WlhTQ0VuQnlhWFpoZEdVdGNtVndieTVzYjJOaGJJSU0KY0hKcGRtRjBaUzF5WlhCdk1CMEdBMVVkRGdRV0JCU0kvUXBudFlOKzhheENnM1JuU3IvUEhZM1FaVEFmQmdOVgpIU01FR0RBV2dCUmk0Q0ZtUmwyajh6U0U4MmJuMWNCdGpHek4wekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBClFMK2llYU9tM3ZveUZaSklaRjRJWUJ1M0hKS1ZGWTAvNjVrenV6SDQrLy9ZNk51dkV6d0U3RHJKWWtjcDVpMHIKTVl0ajh6WmpJMDdyV2F1a3ZuV1pldVZGd0FRQk9FTmFubXZSbFprcUJJVVFPVExzNjFzSSsrYUNhclQyRURZYwpLdS9zNUFUZkpXN1J6UU5pZWxNWUV2YVZ3eUFmakg3dk1jSHltam5wQ0pveFo3eUJWYnNTQkFnWm1QN3FzN1FvCnJ6MHExeUJuWUFEdnR3dlk5aWJKVmhoVlB4ZUp0R0pKR3RrNzJyNFVZbWlFZnIwRU0velNtUzlRZjRoSGFpV28KMVZMR1dOdFFYeU4yYmxscHRMU20rYWFQZ0R1L0FOZ1I0UFhGMnMvUGdmNUNGQ0J6UUpvcGhZVkhOZnNkVUtzNwpTVUJGcFNKUVRaYkZOdm9aV0Zzbkh3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  owner: root:root
  path: /etc/docker/registry/ca.crt
- encoding: b64
  content: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRREwvTlR2d0xQZGEzYUwKRmJKNTZCMnFEUEJhbE5SYWZaSDlhOTBNazlqeE1VQXVSQjhVRkFhWFdDRVF3OTlBOWc3dEJnYjlhbXBOWUc4VApUNXgvYm9sKzhCbVFwN0pRL09Ib3M2UUdpNUhtMlFUaUp2aEsvWjVrcnB3M0hNczZNUmY1OE9pRFZLS2hWYWUrCkswYVVJRzhUSC8xTkMxVWpNM2NNRk84WHA2NWVTRENQUE00amJUM3JENWljWUpUVUVHMk1QbDVDWVJqNXBGWFAKWDZLUnNuanpCdzV0VDVKRTgwd1hCWWNPWXFrVWNKS2t6a05YQTdQTFBhMFk5dC9mbWNNK05HbWdNWXRBeklKYQp5NXFCUTlmM2F1OVdBU2hqUUJnQlIxWFdmWnRZZTRqVE5iUnU1cGJoNFE5c3BkMFpxdFBSU1p5OTUvZUZ1L3VVCnpEckdvc2N4QWdNQkFBRUNnZ0VBSGpsM21aQ2RkZlRheXkvclVubk1qMm84WU1lRmtXVGlzVUIrcjhMbVZaSjkKRm4zY2R2NmluV0VmQVJ0c3BIVHc4RGpBNTJLUm5xWm52dDVBYTNkRzR5cVROeVpKMndzbE0vUU9IVFFuNmFNRgpRTGNTZWhZTEZwTHlyWTNVSk9xcVNVdmpQN1pXSkg2TERMZmZ6TW5qZTF0MWppbGNNNHVJRzUrc2IzNVdiVHlVClNBY01RN2FtY05hK1k0TWY5TXlTdm1YZmQ5SGxDazFLbFNtZnFqK29SYjNScGFlcW9kQXJ3VU5FZXFZZXZCVTcKcmZVb0ZCZzBBZVp4Y1dXWEZtWmdhbkJNRnlzT2hWUEtmblpFWjFtSUNSTjB0Sm82cTlwSnMvRk52Y1dTRHlxdApPYklyaXBzYUVZc1ZFQ1JpVlV4MGEyWXd0MGdGOEJhbWNPVkErbzllbVFLQmdRRGROcDZFVmlRU25PSEw2cHBwCklHcmhuelI2SW52MnNSRWJuNzl2VFRGL1NJdFVJTkdrT092R2E4TU1ENDZSOTJzMUoxRElLelpmbkFFRmdIUGgKUkhwUWQ5MGFEMEo3ZjNkOGlTcjd3Qk1oMFl0dkRIT3lWd3UvNElROEVwWXBWTS82TFZaWUdQV2w1VnlVUUg5cgovVFhBRDRSYVdibCtJdlBRQk9FTmN2dlcvUUtCZ1FEc0VNRzJkdFIwaEMzWXFCWFQ5NHRhaGFPWG1hdWM4a1F4Cmc0VnlOby8yVWd1bHY5WDlGbllURWVDKzRnWW9ONzJ0TytCZVhOZnBOb3AwNTB3YlZEVHRFTDdndjlFaVlrVjEKd0Jvb2VSYXVUVk5wcW9nSlNManBBNTRPTS9kRWkzS2FNc2xoZE1HSkkwczNxZDFTK1NMZTlJc1BPL2lwTzI2NApFRkRJd1ltNVJRS0JnUURXOEVFcG1JRklUSUxnbmIwV3RGYmxqc2x3ZXAwMFgydWVDYVA2UTJqNm9jUXZKQXhPCm9yZ0VmYVJ3elpUYm95blo1YStLTHVLUUY0YXVqOWNJWkg3c1BPcnFiVFZOeGRhVmZMbjFEdllJQUJDWS8rSlMKd0YwOFBLeC9xaGVaWlQwSGVwSFEyNytqUjY2aXBlQ3BUc2l4S3VLUTMybHFkQSt1YVc4Nm9DU3ZDUUtCZ1FDSApNYzJQRHh6N29kdVQwaWUySG5Zcm9JK2hPZnZqeFlleWg2MDhUTzFEMTVjZUZQQ2JvbXA2MzJsRVNMUFlBcHhaCmd3b3JZS2F5eEc2bEp2WWFUSzZHK21rbTFCUVV5ZzBYczY0SGNkbkFkejZITElmK01TemRIaG85N2hyMW9acy8KbmtoZ3pQb3Q3UTJkMG1XVHFHVUZKUzRpeW1qTm11RDgvek1VMW1wbXRRS0JnUUN6aTh1dlMxeU9wYXdNQzZGYQorYjFJYng5S2hqVUVkZS9USmtaLzJYQWpWaUNtVmtiTWY3K1h1dm5RTkVIZ1RndGw0aU14d25BWEdQRG1WRVd3Cm1ob01kTHYzc3dJRjU5MUE2WWpYcC9rK08wRk5pSVkzMUY4azNJaFgza3hBdTY0R1dIKzRGN1krUVczVVFZQi8KdkFIMm5vRGRzWTZ1eVovWWNOdlZJcmppWVE9PQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==
  owner: root:root
  path: /etc/docker/registry/ca.key

disable_root: false
ssh_authorized_keys:
  - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud
runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh ]
  - [ /root/prepare.sh ]
  - [ /usr/sbin/usermod -aG docker ubuntu ]
  - [ /usr/bin/systemctl, enable, docker.service ]
  - [ /usr/bin/systemctl, enable, docker-registry.service ]
