package_update: true
packages:
  - conntrack
users:
  - default
ca_certs:
  trusted:
    - registry_ca_crt
    - |
      -----BEGIN CERTIFICATE-----
      MIIDWzCCAkOgAwIBAgIUUo+y0SUtvkbE+i8AfbvKgv/v7+8wDQYJKoZIhvcNAQEL
      BQAwPTEVMBMGA1UEAwwMcHJpdmF0ZS1yZXBvMRcwFQYDVQQKDA5XZSBsb3ZlIENh
      bGljbzELMAkGA1UEBhMCVVMwHhcNMjQwNDA5MTg1NDEwWhcNMjcwMTI4MTg1NDEw
      WjA9MRUwEwYDVQQDDAxwcml2YXRlLXJlcG8xFzAVBgNVBAoMDldlIGxvdmUgQ2Fs
      aWNvMQswCQYDVQQGEwJVUzCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
      AJOu6L8TNAqH911i+/1bZ0Ov+ua35MECkN+IM866yi1DAJ+//35POqAgX0x3eNJr
      Wv39ccYKyDGBBeHeQuo6oj05vhWcNBCx0JuQDm1wDK6OLV6+W09A35etv8GF3aSY
      RPD5X4IDJ95Bdat8atVx6lw/mB+WYd2jAuJKZjmqm9r0V9aDYgVEwvMrnTUFC+XE
      W+MlxVvs5JfiAMQFFDDRdjOFB5bVP5lMbRctqNTMGdefPaZYkQp8lSsWBtXYlK0F
      VuGJJ6FLvJ0aBEZ2nGoWyz6epXpwn7hxnKNzsi4W9X92mqbxlDIlGU6XyiON+g5w
      a/OBBnJY2jiB4JyYDP++bycCAwEAAaNTMFEwHQYDVR0OBBYEFGLgIWZGXaPzNITz
      ZufVwG2MbM3TMB8GA1UdIwQYMBaAFGLgIWZGXaPzNITzZufVwG2MbM3TMA8GA1Ud
      EwEB/wQFMAMBAf8wDQYJKoZIhvcNAQELBQADggEBAAEJpCisx14unC7cQdibv1x8
      oEbzygV4bQa/wt2M7MFIQYBnmSqEgQbAtxUTK2Ur0/L2Jhe/WC0F7EPk1rZWvsTM
      i+uledpKqtN1FEGRLLx05it2p4nK5Q4+sv3dRjrmxGiwEvYUSMLrG+FWefMjZtWL
      3SoTonesOsCh0xrUn6JZ3Ydpp9N3bCs2OR0uXIBEPcHv7kLJh9D7cqooislEOzsm
      ZMp139TYfv3MEnmCaSYnyEORKWXH2Vrw6VNO1MWhPX/1oQQSGbBfbVwc1icm/Ovn
      tkNsgDps0jv2+3/QYYY+IVhIAfj8AkCbIPlmmNCk+k53Vr1JSsf1+MBvW87SVUw=
      -----END CERTIFICATE-----
ssh_keys:
  rsa_private: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIEowIBAAKCAQEAr1tnUS7tDy0HkOauV++kWj74fP5YYU87nHTos4MyX21Apb3u
    ClQor7Qdf0tK1+rrmS+k2YbUQ6wdW1RgJMJ7es00/4q0NZctQLHiwBiHQPtN4pEO
    IA9YS/jD1EZKODvalsg6Qcz7Y4p0ZF2Ez3Q3t4OY49QmTCPLsPqDsHcX//Xn3hH4
    kGfqWbqoLRCbbcVsdzay6osmYYnIklaEccl5DpbTHaL8zXnnkQdCpBSoY0loY01t
    EESdfWbA7R95cQoUHe2BX07WC9KHt2ZESDcx8H69b801WqJVkxe9B+C1hWk2aZhV
    mflpplza4lB8KL9kwbAmETACZDO9jwIvFprVkQIDAQABAoIBAGGevNGREh+UrdWY
    1g3WNuSWkbbj0Ue62DCtVK46p1xAcfDS3yWY3F2UI6etvqic+zN4NolyadCSjHU/
    b5aHPj6K5qosCU6cLnEJlnXiMcmXHTC4F+j5IeqJPlt6Fe9gQrwWE3h2KKytc0Y8
    Waczx6C9/es3O2q/srF/hLhEVHQFAUzVQ0VAYdHZUcWgrTRtCi+etXaYssXLbuH/
    R0UVb4qctEHRbE9LwLOG8u7o+xC9xYnmMUKAKgyEwwYIR5F1kR3Ebl/cx10owfqV
    YhF7V3hbpAbNUdsdhG/Wv3Q3pRFzz3hRGQpfFPG1PINpf3j5oGTbMzdxuT6ddbq+
    1wNsWcECgYEA3HXqkoRx5bSvIMhrOQJmrXjxo5ecWfa8sLohJJYkka9G3TprA4fy
    9p1IbPgkzDO0RQmCxKQt3Z7OC5mk1owevpF+sJEEFYKhRdOoS8u3VONp6vWUikVc
    hdpeWAOWOc7tiYMyew6+NprBNF2YbgnRnNXdErfGYGt4p2+Yn19+jIUCgYEAy6Ah
    OR8pTaGu2p6WYHJtYPa90zHwVSSBcpNREVoNrIPo/YEOZDPCnKTEX+rHoEdSS1lC
    n2E3hytP7vv/sPGRz2R7h2+2Off47smdt4wJ6zoioOTPjWnCUfix4Kjay5WGswSJ
    tsMVe2WTaUV/bG/d23du4CLmVHnZOmJK0Ml4iJ0CgYBCBgJhLM8bdvg3vi32XdS4
    QQ9E6gPGIZGy75s7ZMfA5Zg4auVfolhOKR5mnA4RJa7oOgfysiSWSZf1e2cVZdNT
    SSmC4XsyofOAgPnW8USPZKf02OVKX6ls4M/+VdyopWMYGrWEiw7GNaSE9T7QPZqL
    +LSDhYwgli8FHfO8TxIMLQKBgQCv5frtIjsGwcWPOvGCDTbpTRw7pWcL1cYw2Itu
    JtGrFiQdYO+ypXfW4wp0JRcfIJ05U7kWft99129sbam6C2O+uPlwzJKozsnuVKH2
    nXUwCv9A54dXjGV9dA0MmjCvLtK2MBRamXkkKGHHzW4+mQAYhrpzyhIYJU3+fkxM
    wc1qjQKBgF7erwUBI5zt+vPcurh/pANDWuEOz1zqBr3svqXytI8UvySuHP9qfHY0
    JLdAyiMNRolMOEVe7umTbB95DifK7DqK2bTw9jrtUdOJ18G5cTf3+pv8NZKCg0B8
    56E90uQJS9aJ/qVZiubWiZpFuIX2tqjulqpp9aN3NbA/Uv8YJa78
    -----END RSA PRIVATE KEY-----

  rsa_public: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCvW2dRLu0PLQeQ5q5X76RaPvh8/lhhTzucdOizgzJfbUClve4KVCivtB1/S0rX6uuZL6TZhtRDrB1bVGAkwnt6zTT/irQ1ly1AseLAGIdA+03ikQ4gD1hL+MPURko4O9qWyDpBzPtjinRkXYTPdDe3g5jj1CZMI8uw+oOwdxf/9efeEfiQZ+pZuqgtEJttxWx3NrLqiyZhiciSVoRxyXkOltMdovzNeeeRB0KkFKhjSWhjTW0QRJ19ZsDtH3lxChQd7YFfTtYL0oe3ZkRINzHwfr1vzTVaolWTF70H4LWFaTZpmFWZ+WmmXNriUHwov2TBsCYRMAJkM72PAi8WmtWR calico@cloud

write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKI0szU19WRVJTSU9OPSJ2MS4yMy4xNiUyQmszczEiCiNLM1NfVkVSU0lPTj0idjEuMjUuOCUyQmszczEiCkszU19WRVJTSU9OPSQxCgpBUkNIPWB1bmFtZSAtbWAKaWYgW1sgJEFSQ0ggPT0gIng4Nl82NCIgXV0KdGhlbgplY2hvICJEb3dubG9hZGluZyBrM3MgYmluYXJ5IGZvciAkQVJDSCIKL3Vzci9iaW4vY3VybCAtTCBodHRwczovL2dpdGh1Yi5jb20vazNzLWlvL2szcy9yZWxlYXNlcy9kb3dubG9hZC8kSzNTX1ZFUlNJT04vazNzIC1vIC91c3IvbG9jYWwvYmluL2szcwplY2hvICJEb3dubG9hZGluZyBjYWxpY29jdGwgYmluYXJ5ICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9wcm9qZWN0Y2FsaWNvL2NhbGljby9yZWxlYXNlcy9sYXRlc3QvZG93bmxvYWQvY2FsaWNvY3RsLWxpbnV4LWFtZDY0IC1vIC91c3IvbG9jYWwvYmluL2NhbGljb2N0bAplbHNlCmVjaG8gIkRvd25sb2FkaW5nIGszcyBiaW5hcnkgZm9yICRBUkNIIgovdXNyL2Jpbi9jdXJsIC1MIGh0dHBzOi8vZ2l0aHViLmNvbS9rM3MtaW8vazNzL3JlbGVhc2VzL2Rvd25sb2FkLyRLM1NfVkVSU0lPTi9rM3MtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vazNzCmVjaG8gIkRvd25sb2FkaW5nIGNhbGljb2N0bCBiaW5hcnkgJEFSQ0giCi91c3IvYmluL2N1cmwgLUwgaHR0cHM6Ly9naXRodWIuY29tL3Byb2plY3RjYWxpY28vY2FsaWNvL3JlbGVhc2VzL2xhdGVzdC9kb3dubG9hZC9jYWxpY29jdGwtbGludXgtYXJtNjQgLW8gL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsCmZpCgovdXNyL2Jpbi9jaG1vZCAreCAvdXNyL2xvY2FsL2Jpbi9rM3MKL3Vzci9iaW4vY2htb2QgK3ggL3Vzci9sb2NhbC9iaW4vY2FsaWNvY3RsIAoKL3Vzci9iaW4vY3VybCBodHRwczovL2dldC5rM3MuaW8vID4gL3Jvb3QvaW5zdGFsbC5zaAovdXNyL2Jpbi9jaG1vZCAreCAvcm9vdC9pbnN0YWxsLnNoCgojIE1hYyBPUyBkaXNjb3ZlcnkgZml4CmNhdCA+PiAvZXRjL3N5c3RlbWQvcmVzb2x2ZWQuY29uZiA8PC1FT0YKTXVsdGljYXN0RE5TPXllcwpEb21haW5zPW11bHRpcGFzcyBtc2hvbWUubmV0IGxvY2FsCkVPRgovdXNyL2Jpbi9zeXN0ZW1jdGwgZW5hYmxlIHN5c3RlbWQtcmVzb2x2ZWQuc2VydmljZQovdXNyL2Jpbi9zeXN0ZW1jdGwgcmVzdGFydCBzeXN0ZW1kLXJlc29sdmVkLnNlcnZpY2UKCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vbWRuc0Auc2VydmljZSA8PC1FT0YKW1NlcnZpY2VdClR5cGU9b25lc2hvdApFeGVjU3RhcnQ9L3Vzci9iaW4vcmVzb2x2ZWN0bCBtZG5zICVpIHllcwpBZnRlcj1zeXMtc3Vic3lzdGVtLW5ldC1kZXZpY2VzLSVpLmRldmljZQoKW0luc3RhbGxdCldhbnRlZEJ5PXN5cy1zdWJzeXN0ZW0tbmV0LWRldmljZXMtJWkuZGV2aWNlCkVPRgoKSU5URVJGQUNFPWBpcCBsaW5rIHNob3cgIHwgZWdyZXAgIlswLTldOiBlbiIgfCBhd2sgJ3sgcHJpbnQgJDIgfScgfCBjdXQgLWQ6IC1mMWAKCi91c3IvYmluL3N5c3RlbWN0bCBlbmFibGUgbWRuc0AkSU5URVJGQUNFLnNlcnZpY2UKL3Vzci9iaW4vc3lzdGVtY3RsIHN0YXJ0IG1kbnNAJElOVEVSRkFDRS5zZXJ2aWNlCiMgTWFjIE9TIGRpc2NvdmVyeSBmaXgKCgpjYXQgPiAvaG9tZS91YnVudHUveHpfdnVsbmVyYWJpbGl0eS5iYXNoIDw8LUVPRgojIS9iaW4vYmFzaAoKZWNobyAiSSdtIGZ1bGx5IGF3YXJlIHRoYXQgYnkgcnVubmluZyB0aGlzIHNjcmlwdCBJJ2xsIG1ha2UgbXkgc3lzdGVtIHZ1bG5lcmFibGUgdG8gY3ZlLTIwMjQtMzA5NCIKZWNobyAiUGxlYXNlIHVzZSAoWSkgdG8gYWNjZXB0IHRoZSBhYm92ZSBzdGF0ZW1lbnQgb3IgYW55dGhpbmcgZWxzZSB0byBjYW5jZWw6IgpyZWFkIC1yc24xIGtleSAgIyBSZWFkIGEgc2luZ2xlIGNoYXJhY3RlciBzaWxlbnRseQppZiBbWyAiXCRrZXkiICE9ICJZIiAmJiAiXCRrZXkiICE9ICJ5IiBdXTsgdGhlbgogICAgZWNobyAiUHJvZ3JhbSB0ZXJtaW5hdGVkLiIKICAgIGV4aXQgMQpmaQoKc3VkbyB3Z2V0IGh0dHBzOi8vc25hcHNob3QuZGViaWFuLm9yZy9hcmNoaXZlL2RlYmlhbi8yMDI0MDMyOFQwMjU2NTdaL3Bvb2wvbWFpbi94L3h6LXV0aWxzL2xpYmx6bWE1XzUuNi4xLTFfYW1kNjQuZGViCnN1ZG8gYXB0LWdldCBpbnN0YWxsIC0tYWxsb3ctZG93bmdyYWRlcyAtLXllcyAuL2xpYmx6bWE1XzUuNi4xLTFfYW1kNjQuZGViCnN1ZG8gY3VybCAtT0wgaHR0cHM6Ly9naXRodWIuY29tL2FtbHdlZW1zL3h6Ym90L3Jhdy9tYWluL2Fzc2V0cy9saWJsem1hLnNvLjUuNi4xLnBhdGNoCnN1ZG8gbXYgbGlibHptYS5zby41LjYuMS5wYXRjaCAvbGliL3g4Nl82NC1saW51eC1nbnUvbGlibHptYS5zby41LjYuMQoKZWNobyAiIgplY2hvICJDb25ncmF0dWxhdGlvbnMgeW91ciBzZXR1cCBpcyBub3cgdnVsbmVyYWJsZSB0byBDVkUtMjAyNC0zMDk0IgpFT0YKCmNobW9kICt4IC9ob21lL3VidW50dS94el92dWxuZXJhYmlsaXR5LmJhc2gKCmNhdCA+IC9ldGMvbW90ZCA8PC1FT0YKClZ1bG5lcmFiaWxpdHkgd29ya3Nob3AsIGFuZCBwcmV2ZW50aW5nIGl0IHdpdGggQ2FsaWNvISEhCkNoZWNrIG91dCBodHRwczovL2dpdGh1Yi5jb20vZnJvemVucHJvY2Vzcy9saWJsem1hLXBvYy1kZW1vIGZvciBtb3JlIGluZm9ybWF0aW9uLgpFT0YK
  owner: root:root
  path: /root/prepare.sh
- encoding: b64
  content: IyEvYmluL2Jhc2gKCiMgTXVsdGkgY2x1c3RlcgpOT0RFX05BTUU9YGhvc3RuYW1lIHwgc2VkIC1lICdzL1woLipcP25vZGVcKS4qXD8vXDEvJ2AKaWYgW1sgIiROT0RFX05BTUUiICE9ICJub2RlIiBdXTt0aGVuCiAgICBDT05UUk9MX05BTUU9YGhvc3RuYW1lIHwgc2VkIC1lICdzL1woLipcP1wpbm9kZS4qXD8vXDFjb250cm9sLydgCmVsc2UKICAgIENPTlRST0xfTkFNRT0iY29udHJvbCIKZmkKCiMgTXVsdGkgY2x1c3RlcgpDT05UUk9MX0lQPSQoZ2V0ZW50IGFob3N0cyAkQ09OVFJPTF9OQU1FIHwgYXdrICd7cHJpbnQgJDF9JyB8IGhlYWQgLW4xKQpUUklFUz0wCndoaWxlIFtbICQoY3VybCAtLXdyaXRlLW91dCAnJXtodHRwX2NvZGV9JyAtLXNpbGVudCAtLW91dHB1dCAvZGV2L251bGwgJENPTlRST0xfSVA6NjQ0MykgIT0gIjQwMCIgXV0KZG8KICAgIGlmIFtbICRUUklFUyAtZXEgNjAgXV07IHRoZW4KICAgICAgICBlY2hvICJGYWlsZWQgdG8gZmluZCB0aGUgazNzIHNlcnZlciIKICAgICAgICBleGl0IDEgCiAgICBmaQogICAgZWNobyAiV2FpdGluZyBmb3IgJENPTlRST0xfSVAiCiAgICBzbGVlcCAxCiAgICBUUklFUz0kKCggVFJJRVMgKyAxICkpCmRvbmUKCiMgSW5jcmVhc2UgcG9kLWNvdW50CmNhdCA+PiAgL2V0Yy9rdWJlbGV0LmNvbmYgPDwtRU9GCmFwaVZlcnNpb246IGt1YmVsZXQuY29uZmlnLms4cy5pby92MWJldGExCmtpbmQ6IEt1YmVsZXRDb25maWd1cmF0aW9uCm1heFBvZHM6IDQwMDAKRU9GCiMgSW5jcmVhc2UgcG9kLWNvdW50CgplY2hvICJBZ2VudHMiCi91c3IvYmluL3NjcCAtaSAiL2V0Yy9zc2gvc3NoX2hvc3RfcnNhX2tleSIgLW8gU3RyaWN0SG9zdEtleUNoZWNraW5nPW5vIHJvb3RAJENPTlRST0xfSVA6L3Zhci9saWIvcmFuY2hlci9rM3Mvc2VydmVyL25vZGUtdG9rZW4gL3Jvb3Qvbm9kZS10b2tlbiAKSzNTX1RPS0VOPWBjYXQgL3Jvb3Qvbm9kZS10b2tlbmAgSzNTX1VSTD0iaHR0cHM6Ly8kQ09OVFJPTF9JUDo2NDQzIiBJTlNUQUxMX0szU19FWEVDPSItLWt1YmVsZXQtYXJnPWNvbmZpZz0vZXRjL2t1YmVsZXQuY29uZiIgSU5TVEFMTF9LM1NfU0tJUF9ET1dOTE9BRD10cnVlIC9yb290L2luc3RhbGwuc2gK
  owner: root:root
  path: /root/node.sh

runcmd:
  - [ /usr/bin/chmod, +x, /root/prepare.sh]
  - [ /root/prepare.sh, "v1.28.8%2Bk3s1" ]
  - [ /usr/bin/chmod, +x, /root/node.sh ]
  - [ /root/node.sh ]
  - [ /usr/bin/chown, -R, ubuntu:ubuntu, /home/ubuntu ]
  - [ /usr/bin/systemctl, enable, k3s.service ]

power_state:
  mode: reboot
